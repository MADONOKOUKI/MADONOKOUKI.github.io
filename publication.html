<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Publications — Koki Madono</title>
  <link rel="stylesheet" href="assets/style.css">
  <meta name="description" content="Publications by Koki Madono">
</head>
<body>
  <header class="wrap">
    <nav class="nav">
      <a href="./">Home</a>
      <a href="publication.html" aria-current="page">Publications</a>
    </nav>
    <h1>Publications</h1>

    <!-- Filters -->
    <div class="pub-filters" role="tablist" aria-label="Publication filters">
      <button data-filter="all" class="active" role="tab" aria-selected="true">All</button>
      <button data-filter="journal" role="tab" aria-selected="false">Journal</button>
      <button data-filter="conference" role="tab" aria-selected="false">Conference</button>
      <button data-filter="thesis" role="tab" aria-selected="false">Thesis</button>
      <button data-filter="japanese" role="tab" aria-selected="false">Japanese</button>
    </div>
  </header>

  <main id="pub-root" class="wrap">
    <noscript>
      <p>Please enable JavaScript to view the publication list.</p>
    </noscript>
  </main>

  <footer class="wrap small">© Koki Madono</footer>

  <script>
  (async ()=>{
    const root = document.getElementById('pub-root');

    // fetch JSON
    let data = [];
    try{
      const res = await fetch('data/publications.json', {cache:'no-store'});
      if(!res.ok) throw new Error('Failed to load publications.json');
      data = await res.json();
    }catch(err){
      root.innerHTML = '<p>Failed to load publications. Please check <code>data/publications.json</code>.</p>';
      console.error(err);
      return;
    }

    // group by year (desc)
    const byYear = {};
    for(const p of data){
      (byYear[p.year] ??= []).push(p);
    }
    const years = Object.keys(byYear).map(Number).sort((a,b)=>b-a);

    // filter buttons
    const filters = document.querySelectorAll('.pub-filters button');

    function render(filter='all'){
      root.innerHTML = '';
      for(const y of years){
        const items = byYear[y].filter(p => filter==='all' || p.type===filter);
        if(items.length===0) continue;

        const h2 = document.createElement('h2');
        h2.className = 'pub-year';
        h2.textContent = y;
        root.appendChild(h2);

        for(const p of items){
          const art = document.createElement('article');
          art.className = 'pub-item';
          art.dataset.type = p.type;

          // optional thumb
          if(p.thumb){
            const img = document.createElement('img');
            img.className = 'pub-thumb';
            img.src = p.thumb;
            img.alt = p.title || '';
            art.appendChild(img);
          }

          // title
          const h3 = document.createElement('h3');
          h3.className = 'pub-title';
          h3.textContent = p.title || '';
          art.appendChild(h3);

          // authors (bold your name)
          const a1 = document.createElement('p');
          a1.className = 'pub-authors';
          const authors = (p.authors || '').replace('K. Madono','<strong>K. Madono</strong>');
          a1.innerHTML = authors;
          art.appendChild(a1);

          // venue, year
          const a2 = document.createElement('p');
          a2.className = 'pub-venue';
          a2.textContent = `${p.venue || ''}${p.year ? ', ' + p.year : ''}`;
          art.appendChild(a2);

          // badges
          if(p.links?.length){
            const pLinks = document.createElement('p');
            pLinks.className = 'pub-links';
            for(const lk of p.links){
              const a = document.createElement('a');
              a.className = 'badge';
              a.href = lk.url;
              a.textContent = lk.label;
              a.target = /^https?:\/\//.test(lk.url) ? '_blank' : undefined;
              if(a.target === '_blank') a.rel = 'noopener noreferrer';
              pLinks.appendChild(a);
              pLinks.appendChild(document.createTextNode(' '));
            }
            art.appendChild(pLinks);
          }

          // abstract
          if(p.abstract){
            const det = document.createElement('details');
            det.className = 'pub-abstract';
            const sum = document.createElement('summary');
            sum.textContent = 'abstract';
            det.appendChild(sum);
            const pAbs = document.createElement('p');
            pAbs.textContent = p.abstract;
            det.appendChild(pAbs);
            art.appendChild(det);
          }

          // bibtex
          if(p.bibtex){
            const det = document.createElement('details');
            det.className = 'pub-bibtex';
            const sum = document.createElement('summary');
            sum.textContent = 'bibtex';
            det.appendChild(sum);
            const pre = document.createElement('pre');
            pre.textContent = p.bibtex;
            det.appendChild(pre);
            art.appendChild(det);
          }

          root.appendChild(art);
        }
      }
      if(!root.innerHTML.trim()){
        root.innerHTML = '<p>No publications for this filter.</p>';
      }
    }

    filters.forEach(b=>{
      b.addEventListener('click', ()=>{
        filters.forEach(x=>{
          x.classList.remove('active');
          x.setAttribute('aria-selected','false');
        });
        b.classList.add('active');
        b.setAttribute('aria-selected','true');
        render(b.dataset.filter);
      });
    });

    render('all');
  })();
  </script>
</body>
</html>
